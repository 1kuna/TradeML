# TradeML Environment Configuration Template
# Copy this file to .env and fill in your API keys
# NEVER commit .env to version control!

# ===== Database Configuration =====
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=trademl
POSTGRES_USER=trademl
POSTGRES_PASSWORD=trademl_dev_pass

# ===== Role & Storage Backend =====
# Role determines which service to run (edge | curator)
ROLE=edge
# Storage backend: local-first on external SSD (no MinIO/S3 required)
STORAGE_BACKEND=local
# Where to store data/logs on the SSD (wizard will prompt/patch)
DATA_ROOT=/srv/ata-data

# ===== MLflow Configuration =====
MLFLOW_TRACKING_URI=http://localhost:5000
MLFLOW_BACKEND_STORE_URI=postgresql://trademl:trademl_dev_pass@localhost:5432/trademl
MLFLOW_S3_ENDPOINT_URL=http://localhost:9000

# ===== Redis Configuration =====
REDIS_HOST=localhost
REDIS_PORT=6379

# ===== Data API Keys (FREE TIER) =====

# Alpaca Markets (https://alpaca.markets/)
# Free tier: real-time and historical data
ALPACA_API_KEY=your_alpaca_api_key_here
ALPACA_SECRET_KEY=your_alpaca_secret_key_here
ALPACA_BASE_URL=https://paper-api.alpaca.markets/v2
ALPACA_DATA_URL=https://data.alpaca.markets/v2

# Alpha Vantage (https://www.alphavantage.co/)
# Free tier: 25 requests/day (generous for corporate actions)
ALPHA_VANTAGE_API_KEY=your_alphavantage_api_key_here

# FRED API (https://fred.stlouisfed.org/docs/api/api_key.html)
# Free tier: unlimited requests (rate-limited)
FRED_API_KEY=your_fred_api_key_here

# Finnhub (https://finnhub.io/)
# Free tier: 60 API calls/minute for stocks, options
FINNHUB_API_KEY=your_finnhub_api_key_here

# Financial Modeling Prep (https://financialmodelingprep.com/)
# Free tier: 250 requests/day
FMP_API_KEY=your_fmp_api_key_here

# ===== UPGRADE PATH: Paid Data Vendors =====

# Databento (https://databento.com/)
# OPRA options, SIP TAQ - pay-as-you-go
# DATABENTO_API_KEY=your_databento_api_key_here

# Massive.com (https://massive.com/) - formerly Polygon.io
# Free tier: 5 req/min, 2 years historical minute data
# Stocks, options, forex - tiered pricing
# POLYGON_API_KEY=your_polygon_api_key_here
# Optional: Override API URL during transition (default: api.massive.com)
# POLYGON_API_URL=https://api.massive.com

# Tiingo (https://www.tiingo.com/)
# EOD, intraday, fundamentals
# TIINGO_API_KEY=your_tiingo_api_key_here

# Intrinio (https://intrinio.com/)
# Fundamentals, real-time quotes
# INTRINIO_API_KEY=your_intrinio_api_key_here

# ===== Tailscale Configuration (Raspberry Pi only) =====
# Get auth key from: https://login.tailscale.com/admin/settings/keys
TS_AUTHKEY=tskey-auth-REPLACE_WITH_YOUR_AUTHKEY
TS_HOSTNAME=minio

# ===== System Configuration =====

# Logging
LOG_LEVEL=INFO
LOG_FILE=logs/trademl.log

# Execution mode
TRADING_MODE=paper  # paper, live, backtest
DRY_RUN=true

# Risk limits
MAX_DRAWDOWN_PCT=20.0
MAX_POSITION_SIZE_PCT=5.0
MAX_SECTOR_EXPOSURE_PCT=25.0
MAX_GROSS_EXPOSURE=1.5
MAX_NET_EXPOSURE=1.0

# Validation thresholds
MIN_SHARPE_OOS=1.0
MAX_PBO_PCT=5.0
MIN_DSR=0.0

# CPCV configuration
CPCV_N_FOLDS=8
CPCV_EMBARGO_DAYS=10
CPCV_OOS_MIN_MONTHS=6

# Execution
MAX_PARTICIPATION_RATE=0.10  # 10% of ADV
SLIPPAGE_TOLERANCE_BPS=20

# Universe
MIN_ADV_USD=1000000  # $1M minimum average daily volume
MIN_PRICE_USD=5.0
UNIVERSE_SIZE=1000

# ===== Secrets & Security =====
# JWT secret for API authentication (generate with: openssl rand -hex 32)
JWT_SECRET=your_jwt_secret_here

# Webhook secrets (if using alerts)
SLACK_WEBHOOK_URL=
DISCORD_WEBHOOK_URL=

# ===== Feature Flags =====
ENABLE_SHADOW_TRADING=true
ENABLE_OPTIONS_SLEEVE=false  # Start with equities only
ENABLE_INTRADAY_REBALANCE=false
ENABLE_AUTO_PROMOTION=false  # Manual approval for champion promotion initially

# ===== Development =====
DEBUG=false
PROFILE=false
CACHE_ENABLED=true
NODE_ENABLE_OPTIONS_QA=true

# ===== Concurrency (RPi workers) =====
# Global worker cap for IO-bound tasks (modest default for Pi)
NODE_WORKERS=6
# Per-source inflight limits (uppercased source name)
NODE_MAX_INFLIGHT_ALPACA=3
NODE_MAX_INFLIGHT_POLYGON=2
NODE_MAX_INFLIGHT_FINNHUB=2
NODE_MAX_INFLIGHT_FRED=2
# Batch sizing knobs
NODE_POLYGON_SYMBOLS_PER_UNIT=10
NODE_FINNHUB_UL_PER_UNIT=5

# ===== Edge Scheduler =====
# Scheduler mode: legacy (single global pool) or per_vendor (one executor per vendor)
EDGE_SCHEDULER_MODE=per_vendor
# Per-vendor cooldown after 429s (seconds)
NODE_VENDOR_FREEZE_SECONDS_ALPACA=60
NODE_VENDOR_FREEZE_SECONDS_POLYGON=60
NODE_VENDOR_FREEZE_SECONDS_FINNHUB=60
NODE_VENDOR_FREEZE_SECONDS_FRED=60

# ===== Backfill Horizons (defaults)
# Daily bars (Alpaca): default 15 years
ALPACA_DAY_START_DAYS=5475
# Minute bars (Alpaca): default 2 years (free-tier practical range)
ALPACA_MINUTE_START_DAYS=730
# Polygon day bars: default 10 years
POLYGON_DAY_START_DAYS=3650
# FRED macro/treasury: default 50 years
FRED_TREASURY_START_DAYS=18250

# ===== Future addition: optional remote/object storage =====
# Keep commented unless you explicitly add a remote sync/replication layer.
# S3_ENDPOINT=http://localhost:9000
# S3_BUCKET=ata
# S3_REGION=us-east-1
# S3_FORCE_PATH_STYLE=true
# AWS_ACCESS_KEY_ID=
# AWS_SECRET_ACCESS_KEY=

# ===== Options (Alpaca via SDK) =====
# Feed preference for chain/snapshots: opra|indicative (indicative when no OPRA entitlement)
ALPACA_OPTIONS_FEED=indicative
# Days back for option bars (per-day aggregation)
ALPACA_OPTIONS_BARS_START_DAYS=7
# Contracts per underlier per unit (be conservative)
ALPACA_OPTIONS_CONTRACTS_PER_UNIT=50
# Underliers per unit (how many symbols per day)
NODE_ALPACA_OPTIONS_UL_PER_UNIT=3
# Timeframe for option bars: 1Day|1Min|5Min|15Min
ALPACA_OPTIONS_TIMEFRAME=1Day
# If using 'indicative' feed for chain snapshots, control whether to save quotes/greeks
ALPACA_OPTIONS_SAVE_INDICATIVE_QUOTES=false

# Options chain daily snapshots (accumulate history)
ALPACA_OPTIONS_CHAIN_START_DAYS=7
# Corporate actions backfill horizon (days)
ALPACA_CORPACTIONS_START_DAYS=5475

# ===== Request Pacing (global smoother) =====
# Enable global request pacer to smooth API calls across threads
REQUEST_PACING_ENABLED=true
# Jitter range added to pacing sleeps (milliseconds)
REQUEST_PACING_JITTER_MS=50,150

# ===== EOD fetch gating =====
# Skip fetching 'today' for daily/EOD timeframe unless allowed past cutoff
EOD_FETCH_TODAY=false
EOD_TODAY_CUTOFF_UTC_HOUR=22
