scheduler:
  timezone: America/New_York

policy:
  max_concurrency: 3

  # Legacy daily budget caps (used by existing backfill code)
  # Verified free tier limits as of Dec 2025
  daily_api_budget:
    alpaca:  { requests: 288000 }  # 200 rpm * 60 * 24
    finnhub: { requests: 86400 }   # 60 rpm * 60 * 24
    av:      { requests: 25 }      # Alpha Vantage: 25/day HARD CAP
    fred:    { requests: 172800 }  # 120 rpm * 60 * 24
    massive: { requests: 7200 }    # 5 rpm * 60 * 24
    # FMP removed - free tier has severe endpoint restrictions

  # Per-vendor rate limits for unified data-node queue (ยง1.1 of node spec)
  # hard_rpm: requests-per-minute ceiling (token bucket)
  # soft_daily_cap: daily request budget for 85/90/100% slices
  # Verified free tier limits as of Dec 2025
  rate_limits:
    alpaca:
      hard_rpm: 200          # Free tier: 200 req/min
      soft_daily_cap: 288000 # 200 * 60 * 24 theoretical max
    finnhub:
      hard_rpm: 60           # Free tier: 60 req/min
      soft_daily_cap: 86400  # 60 * 60 * 24 theoretical max
    av:
      hard_rpm: 5            # Free tier: 5 req/min
      soft_daily_cap: 25     # HARD CAP: 25 requests/day
    fred:
      hard_rpm: 120          # ~120 req/min (from support emails)
      soft_daily_cap: 172800 # 120 * 60 * 24 theoretical max
    massive:
      hard_rpm: 5            # Free tier: 5 req/min
      soft_daily_cap: 7200   # 5 * 60 * 24 theoretical max
    # FMP removed - free tier has severe endpoint restrictions (~80 tickers only)

  priorities:
    - { table: corp_actions,     weight: 100 }
    - { table: delistings,       weight: 100 }
    - { table: equities_eod,     weight: 90 }
    - { table: equities_minute,  weight: 80 }
    - { table: options_chains,   weight: 70 }
    - { table: options_nbbo,     weight: 60 }
    - { table: fundamentals,     weight: 60 }

targets:
  equities_eod:    { earliest: '2000-01-01', chunk_days: 30, expect_rows: 1 }
  equities_minute: { earliest: '2010-01-01', chunk_days: 1,  expect_rows: 390, top_n: 1000 }
  options_chains:  { earliest: '2015-01-01', chunk_days: 1,  expect_contracts_min: 50 }
  macro_treasury:  { earliest: '2000-01-01', chunk_days: 365, expect_rows: 5 }
  macro_vintages:  { series: ['DGS10','CPIAUCSL'] }
  fundamentals:     { earliest: '2000-01-01', chunk_days: 1 }
  options_chain_hist: { earliest: '2015-01-01', chunk_days: 1 }
  equities_eod_fn:  { earliest: '2000-01-01', chunk_days: 30 }

qc_thresholds:
  green_min_ratio: 0.98
  rows_low_ratio:  0.90
  rows_high_ratio: 1.20
  allow_halfdays:  true

horizons:
  equities_eod:    { collect_earliest: '1990-01-01', train_window_years: 15 }
  equities_minute: { collect_earliest: '2010-01-01', train_window_years: 10 }
  equities_ticks:  { collect_earliest: '2012-06-01', train_window_years: 4 }
  options_chains:  { collect_earliest: '2012-01-01', train_window_years: 10 }
  options_nbbo:    { collect_earliest: '2010-01-01', train_window_years: 8 }
